[{"filePath":"C:\\Users\\abcde\\OneDrive\\Desktop\\codes\\VSapps\\Serify\\pages\\flow\\[id].tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'currentConcept', 'currentStep', 'fetchNextStep', and 'stepping'. Either include them or remove the dependency array.","line":260,"column":8,"nodeType":"ArrayExpression","endLine":260,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [currentConcept, currentStep, fetchNextStep, flowSession, stepping]","fix":{"range":[12385,12398],"text":"[currentConcept, currentStep, fetchNextStep, flowSession, stepping]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { useRouter } from 'next/router';\r\nimport Head from 'next/head';\r\nimport DashboardLayout from '@/components/Layout/DashboardLayout';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { supabase } from '@/lib/supabase';\r\nimport {\r\n    Zap, Brain, Loader2, ChevronRight, CheckCircle2,\r\n    BookOpen, HelpCircle, Target, Route, ShieldAlert, Replace, Send, Layers\r\n} from 'lucide-react';\r\nimport { FlowSession, FlowStep, FlowStepType } from '@/types/serify';\r\n\r\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Sub-components â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n\r\nfunction ProgressBar({ concepts, currentConceptId }: { concepts: any[]; currentConceptId?: string }) {\r\n    const done = concepts.filter(c => c.status === 'completed').length;\r\n    const total = concepts.length;\r\n    return (\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 8 }}>\r\n            <div style={{ flex: 1, height: 6, background: 'var(--border)', borderRadius: 99, overflow: 'hidden' }}>\r\n                <div style={{ height: '100%', width: `${total ? (done / total) * 100 : 0}%`, background: 'var(--accent)', borderRadius: 99, transition: 'width 0.5s ease' }} />\r\n            </div>\r\n            <span style={{ fontSize: 12, color: 'var(--text-muted)', whiteSpace: 'nowrap' }}>{done}/{total} concepts</span>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction StepIcon({ type }: { type: FlowStepType }) {\r\n    const MAP: Partial<Record<string, JSX.Element>> = {\r\n        orient: <Target size={16} />,\r\n        build_layer: <Layers size={16} />,\r\n        anchor: <BookOpen size={16} />,\r\n        check: <HelpCircle size={16} />,\r\n        reinforce: <Replace size={16} />,\r\n        confirm: <CheckCircle2 size={16} />,\r\n    };\r\n    return MAP[type] || <Zap size={16} />;\r\n}\r\n\r\nfunction ActionButton({ label, icon, primary, secondary, onClick, disabled }: { label: string; icon?: JSX.Element; primary?: boolean; secondary?: boolean; onClick: () => void; disabled?: boolean }) {\r\n    const bg = primary ? 'var(--accent)' : secondary ? 'transparent' : 'var(--surface)';\r\n    const border = primary ? 'var(--accent)' : secondary ? 'var(--border)' : 'var(--border)';\r\n    const text = primary ? 'white' : 'var(--text-primary)';\r\n\r\n    return (\r\n        <button onClick={onClick} disabled={disabled} style={{\r\n            display: 'inline-flex', alignItems: 'center', gap: 7,\r\n            background: bg, color: text,\r\n            border: `1.5px solid ${border}`,\r\n            borderRadius: 10, padding: '9px 18px', fontSize: 14, fontWeight: 600,\r\n            cursor: disabled ? 'not-allowed' : 'pointer', opacity: disabled ? 0.6 : 1, transition: 'all 0.15s'\r\n        }}>\r\n            {icon}{label}\r\n        </button>\r\n    );\r\n}\r\n\r\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Step Types â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n\r\nfunction OrientStep({ content, onNext }: { content: any; onNext: (response: string) => void }) {\r\n    return (\r\n        <div>\r\n            <p style={{ fontSize: 13, color: 'var(--accent)', fontWeight: 700, textTransform: 'uppercase', letterSpacing: 1, marginBottom: 8 }}>\r\n                <Target size={14} style={{ display: 'inline', marginRight: 6, marginBottom: -2 }} />\r\n                Orientation\r\n            </p>\r\n            <p style={{ lineHeight: 1.8, fontSize: 16 }}>{content.text}</p>\r\n            <div style={{ display: 'flex', marginTop: 20 }}>\r\n                <ActionButton label=\"Got it\" icon={<ChevronRight size={16} />} primary onClick={() => onNext('got_it')} />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction BuildLayerStep({ content, onNext }: { content: any; onNext: (response: string) => void }) {\r\n    const isMechanism = content.layerType === 'mechanism';\r\n    const isExample = content.layerType === 'example';\r\n    const isConnection = content.layerType === 'connection';\r\n\r\n    let containerStyle: React.CSSProperties = { marginBottom: 16 };\r\n    let textStyle: React.CSSProperties = { lineHeight: 1.8, fontSize: 15.5 };\r\n\r\n    if (isMechanism) {\r\n        textStyle = { ...textStyle, fontFamily: 'monospace', background: 'var(--surface-2, var(--surface))', padding: '12px 16px', borderRadius: 8, border: '1px solid var(--border)' };\r\n    } else if (isExample) {\r\n        containerStyle = { ...containerStyle, background: 'var(--accent)08', border: '1px solid var(--accent)20', padding: '16px 20px', borderRadius: 12 };\r\n    } else if (isConnection) {\r\n        containerStyle = { ...containerStyle, borderLeft: '4px solid var(--accent)', paddingLeft: 16 };\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <div style={containerStyle}>\r\n                <p style={textStyle}>{content.text}</p>\r\n            </div>\r\n            <div style={{ display: 'flex', marginTop: 20 }}>\r\n                <ActionButton label=\"Continue\" icon={<ChevronRight size={16} />} primary onClick={() => onNext('continue')} />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction AnchorStep({ content, onNext }: { content: any; onNext: (response: string) => void }) {\r\n    return (\r\n        <div>\r\n            <p style={{ lineHeight: 1.8, fontSize: 15.5 }}>{content.text}</p>\r\n            <div style={{ display: 'flex', gap: 10, marginTop: 24 }}>\r\n                <ActionButton label=\"Makes sense\" primary onClick={() => onNext('makes_sense')} />\r\n                <ActionButton label=\"That doesn't help\" secondary onClick={() => onNext('needs_work')} />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction CheckQuestionStep({ content, stepId, onEvaluated }: { content: any; stepId: string; onEvaluated: (response: string, evaluation: any) => void }) {\r\n    const [answer, setAnswer] = useState('');\r\n    const [submitting, setSubmitting] = useState(false);\r\n\r\n    const submit = async () => {\r\n        if (!answer.trim() || submitting) return;\r\n        setSubmitting(true);\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            const res = await fetch('/api/flow/evaluate', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session?.access_token}` },\r\n                body: JSON.stringify({ stepId, userResponse: answer }),\r\n            });\r\n            const data = await res.json();\r\n            onEvaluated(answer, data.evaluation);\r\n        } finally { setSubmitting(false); }\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <p style={{ fontSize: 16, fontWeight: 600, marginBottom: 14 }}>{content.questionText}</p>\r\n            <textarea\r\n                value={answer}\r\n                onChange={e => setAnswer(e.target.value)}\r\n                onKeyDown={e => { if (e.key === 'Enter' && e.ctrlKey) submit(); }}\r\n                placeholder=\"Type your answer hereâ€¦\"\r\n                rows={4}\r\n                style={{\r\n                    width: '100%', background: 'var(--surface)', border: '1.5px solid var(--border)', color: 'var(--text-primary)',\r\n                    borderRadius: 10, padding: '12px 14px', fontSize: 14.5, lineHeight: 1.6, resize: 'vertical',\r\n                    fontFamily: 'inherit', outline: 'none', boxSizing: 'border-box'\r\n                }}\r\n            />\r\n            <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: 10 }}>\r\n                <ActionButton label={submitting ? 'Evaluatingâ€¦' : 'Submit'} icon={submitting ? <Loader2 size={16} style={{ animation: 'spin 1s linear infinite' }} /> : <Send size={16} />} primary onClick={submit} disabled={!answer.trim() || submitting} />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction ReinforceStep({ content, onNext }: { content: any; onNext: (response: string) => void }) {\r\n    const isPathB = content.path === 'B';\r\n    const isPathC = content.path === 'C';\r\n\r\n    const borderStyle = isPathB ? '1px solid #eab30840' : '1px solid var(--border)';\r\n    const bgStyle = isPathB ? '#eab3080a' : 'transparent';\r\n\r\n    return (\r\n        <div style={{ background: bgStyle, border: borderStyle, padding: isPathB ? '16px 20px' : 0, borderRadius: 12 }}>\r\n            {isPathB && <p style={{ fontSize: 12, fontWeight: 700, color: '#eab308', textTransform: 'uppercase', marginBottom: 8, letterSpacing: 0.5 }}>Alternative Angle</p>}\r\n            <p style={{ lineHeight: 1.8, fontSize: 15.5 }}>{content.text}</p>\r\n            <div style={{ display: 'flex', marginTop: 24 }}>\r\n                <ActionButton label=\"I see now\" primary icon={<ChevronRight size={16} />} onClick={() => onNext('got_it')} />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction EvaluationBanner({ evaluation, onContinue }: { evaluation: any; onContinue: () => void }) {\r\n    // Path A: confirm + add nuance (Greenish)\r\n    // Path B: acknowledge right + explain missing (Yellowish)\r\n    // Path C: completely missed (Neutral to avoid failure styling, per spec)\r\n\r\n    let bgColor = 'var(--surface)';\r\n    let borderColor = 'var(--border)';\r\n    let textColor = 'var(--text-primary)';\r\n    let headerText = 'Review';\r\n    let headerColor = 'var(--text-muted)';\r\n\r\n    if (evaluation.path === 'A') {\r\n        bgColor = '#22c55e10'; borderColor = '#22c55e40';\r\n        headerColor = '#22c55e'; headerText = 'âœ“ Excellent';\r\n    } else if (evaluation.path === 'B') {\r\n        bgColor = '#eab30810'; borderColor = '#eab30840';\r\n        headerColor = '#eab308'; headerText = 'â—‘ Almost there';\r\n    } else {\r\n        // Path C: neutral per spec\r\n        headerText = 'Let\\'s align';\r\n    }\r\n\r\n    return (\r\n        <div style={{\r\n            background: bgColor, border: `1.5px solid ${borderColor}`,\r\n            borderRadius: 12, padding: '16px 20px', marginTop: 24\r\n        }}>\r\n            <p style={{ fontWeight: 700, color: headerColor, marginBottom: 8, fontSize: 13, textTransform: 'uppercase', letterSpacing: 0.5 }}>\r\n                {headerText}\r\n            </p>\r\n            <p style={{ fontSize: 15, color: textColor, margin: '0 0 16px', lineHeight: 1.6 }}>{evaluation.feedbackText}</p>\r\n            <ActionButton label=\"Continue\" icon={<ChevronRight size={16} />} primary onClick={onContinue} />\r\n        </div>\r\n    );\r\n}\r\n\r\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Main Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n\r\nexport default function FlowSessionPage() {\r\n    const router = useRouter();\r\n    const { id } = router.query as { id?: string };\r\n    const { user } = useAuth();\r\n\r\n    const [flowSession, setFlowSession] = useState<FlowSession | null>(null);\r\n    const [currentConceptIndex, setCurrentConceptIndex] = useState(0);\r\n    const [currentStep, setCurrentStep] = useState<FlowStep | null>(null);\r\n    const [pendingEvaluation, setPendingEvaluation] = useState<any | null>(null);\r\n    const [stepHistory, setStepHistory] = useState<FlowStep[]>([]);\r\n    const [conceptStatuses, setConceptStatuses] = useState<Record<string, 'not_started' | 'in_progress' | 'completed'>>({});\r\n    const [loading, setLoading] = useState(true);\r\n    const [stepping, setStepping] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [sessionDone, setSessionDone] = useState(false);\r\n\r\n    const currentConcept = flowSession?.initial_plan?.concepts?.[currentConceptIndex];\r\n    const totalConcepts = flowSession?.initial_plan?.concepts?.length || 0;\r\n\r\n    // Load existing session from DB\r\n    useEffect(() => {\r\n        if (!id || !user) return;\r\n        (async () => {\r\n            setLoading(true);\r\n            const { data, error: dbErr } = await supabase\r\n                .from('flow_sessions')\r\n                .select('*')\r\n                .eq('id', id)\r\n                .single();\r\n\r\n            if (dbErr || !data) { setError('Session not found.'); setLoading(false); return; }\r\n            setFlowSession(data as FlowSession);\r\n\r\n            // Init concept statuses\r\n            const statuses: Record<string, 'not_started' | 'in_progress' | 'completed'> = {};\r\n            (data.initial_plan?.concepts || []).forEach((c: any) => {\r\n                statuses[c.conceptId] = data.concepts_completed.includes(c.conceptId) ? 'completed' : 'not_started';\r\n            });\r\n            setConceptStatuses(statuses);\r\n            setLoading(false);\r\n        })();\r\n    }, [id, user]);\r\n\r\n    // Request the first step after loading\r\n    useEffect(() => {\r\n        if (flowSession && !currentStep && !stepping && currentConcept) {\r\n            fetchNextStep();\r\n        }\r\n    }, [flowSession]);\r\n\r\n    const fetchNextStep = useCallback(async () => {\r\n        if (!flowSession || !currentConcept || stepping) return;\r\n        setStepping(true);\r\n        setPendingEvaluation(null);\r\n        setError(null);\r\n\r\n        try {\r\n            const { data: { session: authSession } } = await supabase.auth.getSession();\r\n\r\n            // We ensure orchestration is completed before starting steps\r\n            const { data: progress } = await supabase\r\n                .from('flow_concept_progress')\r\n                .select('orchestrator_plan')\r\n                .eq('flow_session_id', flowSession.id)\r\n                .eq('concept_id', currentConcept.conceptId)\r\n                .single();\r\n\r\n            if (!progress || !progress.orchestrator_plan) {\r\n                // Not orchestrated yet, trigger orchestration\r\n                await fetch('/api/flow/orchestrate', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authSession?.access_token}` },\r\n                    body: JSON.stringify({ sessionId: flowSession.id, conceptId: currentConcept.conceptId }),\r\n                });\r\n            }\r\n\r\n            const res = await fetch('/api/flow/step', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authSession?.access_token}` },\r\n                body: JSON.stringify({\r\n                    sessionId: flowSession.id,\r\n                    conceptId: currentConcept.conceptId\r\n                }),\r\n            });\r\n\r\n            const data = await res.json();\r\n            if (!res.ok) throw new Error(data.error || 'Step failed');\r\n\r\n            if (data.action === 'concept_complete') {\r\n                // Mark concept done and move to next\r\n                const updatedConceptsCompleted = [...(flowSession.concepts_completed || []), currentConcept.conceptId];\r\n                await supabase.from('flow_sessions').update({ concepts_completed: updatedConceptsCompleted }).eq('id', flowSession.id);\r\n\r\n                setConceptStatuses(prev => ({ ...prev, [currentConcept.conceptId]: 'completed' }));\r\n                if (currentConceptIndex + 1 < totalConcepts) {\r\n                    setCurrentConceptIndex(i => i + 1);\r\n                    setCurrentStep(null);\r\n                    setStepHistory([]);\r\n                } else {\r\n                    setSessionDone(true);\r\n                }\r\n            } else {\r\n                setCurrentStep(data.step);\r\n                setStepHistory(prev => [...prev, data.step]);\r\n                setConceptStatuses(prev => ({ ...prev, [currentConcept.conceptId]: 'in_progress' }));\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message);\r\n        } finally {\r\n            setStepping(false);\r\n        }\r\n    }, [flowSession, currentConcept, currentConceptIndex, totalConcepts, stepping]);\r\n\r\n    const handleUserResponse = async (responseType: string) => {\r\n        if (!currentStep) return;\r\n        // Patch the response onto the step in DB (non-blocking, fire-and-forget)\r\n        supabase.auth.getSession().then(({ data: { session } }) => {\r\n            fetch('/api/flow/evaluate', {  // Even for non-AI evaluate routes, we can just save it or map a simple route\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${session?.access_token}` },\r\n                body: JSON.stringify({ stepId: currentStep.id, userResponse: responseType }),\r\n            }).catch(() => { });\r\n        });\r\n\r\n        fetchNextStep();\r\n    };\r\n\r\n    const handleEvaluated = (response: string, evaluation: any) => {\r\n        setPendingEvaluation(evaluation);\r\n    };\r\n\r\n    const renderStep = () => {\r\n        if (!currentStep) return null;\r\n        const { step_type, content } = currentStep;\r\n\r\n        const onSimpleNext = (r: string) => handleUserResponse(r);\r\n\r\n        if (step_type === 'orient') return <OrientStep content={content} onNext={onSimpleNext} />;\r\n        if (step_type === 'build_layer') return <BuildLayerStep content={content} onNext={onSimpleNext} />;\r\n        if (step_type === 'anchor') return <AnchorStep content={content} onNext={onSimpleNext} />;\r\n        if (step_type === 'check' || step_type === 'confirm') return <CheckQuestionStep content={content} stepId={currentStep.id} onEvaluated={handleEvaluated} />;\r\n        if (step_type === 'reinforce') return <ReinforceStep content={content} onNext={onSimpleNext} />;\r\n\r\n        return null;\r\n    };\r\n\r\n    if (loading) return (\r\n        <DashboardLayout>\r\n            <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '60vh' }}>\r\n                <Loader2 size={36} style={{ animation: 'spin 1s linear infinite', color: 'var(--accent)' }} />\r\n            </div>\r\n        </DashboardLayout>\r\n    );\r\n\r\n    if (sessionDone) return (\r\n        <DashboardLayout>\r\n            <div style={{ maxWidth: 600, margin: '4rem auto', textAlign: 'center', padding: '0 1rem' }}>\r\n                <div style={{ fontSize: 64, marginBottom: 16 }}>ðŸŽ‰</div>\r\n                <h1 style={{ fontSize: '2rem', fontWeight: 800, marginBottom: 8 }}>Flow complete!</h1>\r\n                <p style={{ color: 'var(--text-muted)', marginBottom: 28 }}>\r\n                    You worked through {totalConcepts} concept{totalConcepts !== 1 ? 's' : ''} in this session.\r\n                </p>\r\n                <div style={{ display: 'flex', gap: 12, justifyContent: 'center', flexWrap: 'wrap' }}>\r\n                    <ActionButton label=\"Back to Vault\" onClick={() => router.push('/vault')} />\r\n                    <ActionButton label=\"New Flow Session\" primary onClick={() => router.push('/flow')} />\r\n                </div>\r\n            </div>\r\n        </DashboardLayout>\r\n    );\r\n\r\n    return (\r\n        <>\r\n            <Head><title>Flow Mode â€” {currentConcept?.conceptName || 'Loading'}</title></Head>\r\n            <DashboardLayout>\r\n                <div style={{ maxWidth: 720, margin: '0 auto', padding: '1.5rem 1rem' }}>\r\n                    {/* Top: concept header + progress */}\r\n                    <div style={{ marginBottom: 20 }}>\r\n                        {flowSession && (\r\n                            <ProgressBar\r\n                                concepts={(flowSession.initial_plan?.concepts || []).map(c => ({ ...c, status: conceptStatuses[c.conceptId] || 'not_started' }))}\r\n                                currentConceptId={currentConcept?.conceptId}\r\n                            />\r\n                        )}\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\r\n                            <div style={{\r\n                                background: 'linear-gradient(135deg, #7c3aed22, #4f46e522)',\r\n                                border: '1px solid #7c3aed55', borderRadius: 10,\r\n                                padding: '6px 12px', fontSize: 12, fontWeight: 700, color: '#a78bfa'\r\n                            }}>\r\n                                {currentConcept?.conceptName || 'â€”'}\r\n                            </div>\r\n                            {currentStep && (\r\n                                <span style={{ fontSize: 12, color: 'var(--text-muted)', display: 'flex', alignItems: 'center', gap: 4 }}>\r\n                                    <StepIcon type={currentStep.step_type as FlowStepType} />\r\n                                    {currentStep.step_type.replace(/_/g, ' ')}\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {error && (\r\n                        <div style={{ background: '#ef444420', border: '1px solid #ef4444', color: '#ef4444', borderRadius: 10, padding: '12px 16px', marginBottom: 16, fontSize: 14 }}>\r\n                            {error}\r\n                            <button onClick={() => fetchNextStep()} style={{ marginLeft: 12, cursor: 'pointer', background: 'none', border: 'none', color: '#ef4444', textDecoration: 'underline', fontSize: 13 }}>Retry</button>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step Card */}\r\n                    <div style={{\r\n                        background: 'var(--surface)', border: '1.5px solid var(--border)',\r\n                        borderRadius: 18, padding: '1.75rem 2rem', minHeight: 220,\r\n                        transition: 'all 0.2s'\r\n                    }}>\r\n                        {stepping ? (\r\n                            <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', minHeight: 180, gap: 14, color: 'var(--text-muted)' }}>\r\n                                <Loader2 size={30} style={{ animation: 'spin 1s linear infinite', color: 'var(--accent)' }} />\r\n                                <span style={{ fontSize: 14 }}>Orchestrating the next connectionâ€¦</span>\r\n                            </div>\r\n                        ) : (\r\n                            <>\r\n                                {renderStep()}\r\n                                {pendingEvaluation && (\r\n                                    <EvaluationBanner evaluation={pendingEvaluation} onContinue={() => fetchNextStep()} />\r\n                                )}\r\n                            </>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Step history (light) */}\r\n                    {stepHistory.length > 1 && (\r\n                        <div style={{ marginTop: 20, display: 'flex', gap: 6, flexWrap: 'wrap' }}>\r\n                            {stepHistory.slice(0, -1).map((s, i) => (\r\n                                <div key={s.id} style={{\r\n                                    fontSize: 11, color: 'var(--text-muted)', background: 'var(--surface)',\r\n                                    border: '1px solid var(--border)', borderRadius: 6, padding: '3px 8px',\r\n                                    display: 'flex', alignItems: 'center', gap: 4\r\n                                }}>\r\n                                    <StepIcon type={s.step_type as FlowStepType} />\r\n                                    {s.step_type.replace(/_/g, ' ')}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </DashboardLayout>\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]}]
